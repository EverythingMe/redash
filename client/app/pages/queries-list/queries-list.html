<div class="container">
  <page-header title="Queries"></page-header>

  <div class="row">
    <div class="col-md-3 list-control-t">
      <div class='list-group m-b-10 tags-list tiled'>
        <a href="queries" class="list-group-item" ng-class="{active: $ctrl.currentPage == 'all'}">
          All Queries
        </a>
        <a href="queries/favorite" class="list-group-item" ng-class="{active: $ctrl.currentPage == 'favorites'}">
          <span class="btn-favourite">
            <i class="fa fa-star" aria-hidden="true"></i>
          </span>
          Favorites
        </a>
        <a href="queries/my" class="list-group-item" ng-if="$ctrl.showMyQueries" ng-class="{active: $ctrl.currentPage == 'my'}">
          <img ng-src="{{$ctrl.currentUser.profile_image_url}}" class="profile__image--navbar" width="13" style="margin-right: 0;"
          /> My Queries
        </a>
      </div>

      <div ng-if="$ctrl.currentPage != 'my'">
        <input type="text" class="form-control" placeholder="Search Queries..." autofocus ng-model="$ctrl.term" ng-model-options="{ allowInvalid: true, debounce: 200 }"
          ng-change="$ctrl.update()">

        <div class="m-b-10">
          <tags-list tags-url="api/queries/tags" on-tags-update="$ctrl.onTagsUpdate"></tags-list>
        </div>
      </div>

    </div>

    <div ng-if="!$ctrl.loaded" class="col-md-9 list-content text-center p-t-15 p-b-15">
      <div class="tiled bg-white p-15">
        <i class="fa fa-spinner fa-2x fa-pulse"></i>
        <br>
        Loading queries...
      </div>
    </div>

    <!--Empty states-->
    <div ng-if="$ctrl.loaded && $ctrl.showEmptyState" class="col-md-9 list-content">
      <!--No queries-->
      <div ng-if="($ctrl.currentPage == 'all') && ($ctrl.searchText.length == undefined)">
        <empty-state icon="fa fa-code" illustration="query" description="Getting the data from your datasources." help-link="http://help.redash.io/category/21-querying"></empty-state>
      </div>
      <!--My queries, no query-->
      <div class="tiled bg-white p-15 text-center" ng-if="$ctrl.currentPage == 'my'">
        <h3 class="m-t-0 m-b-0"><i class="fa fa-bar-chart" aria-hidden="true"></i></h3>
        <br>
        <a href="/queries/new" class="btn btn-primary btn-sm">Create your first query</a> to populate My Queries list. Need help? Check out our
        <a href="https://redash.io/help/user-guide/querying/writing-queries">query writing documentation</a>.
      </div>
      <!--No favourites-->
      <div class="tiled bg-white p-15 text-center" ng-if="($ctrl.currentPage == 'favorites') && ($ctrl.searchText.length == undefined)">
        <h3 class="m-t-0 m-b-0"><i class="fa fa-star" aria-hidden="true"></i></h3>
        <br>
        Mark queries as favorite
        <span class="btn-favourite">
          <i class="fa fa-star" aria-hidden="true"></i>
        </span> to list them here.
      </div>
      <!--No search hits-->
      <div class="tiled bg-white p-15 text-center" ng-if="$ctrl.currentPage == 'search'">
        <h3><i class="fa fa-search" aria-hidden="true"></i></h3>
        <br>
        Sorry, we couldn't find anything.
      </div>
      <!--No query found for this tag-->
      <div class="tiled bg-white p-15 text-center" ng-if="$ctrl.queryNotFoundTag">
        <h3><i class="fa fa-tag" aria-hidden="true"></i></h3>
        <br>
        No query found tagged with 'X' (probably the query is archived by now).
      </div>
    </div>

    <div ng-if="$ctrl.loaded && !$ctrl.showEmptyState" class="col-md-9 list-content">

      <div class="bg-white tiled">
        <table class="table table-condensed table-hover table-data">
          <thead>
            <tr>
              <th></th>
              <th>Name</th>
              <th></th>
              <th>Created At</th>
              <th>Runtime</th>
              <th>Last Executed At</th>
              <th>Update Schedule</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="query in $ctrl.paginator.getPageRows()" ng-click="$ctrl.navigateTo($event, 'queries/' + query.id)">
              <td class="p-r-0">
                <favorites-control item="query"></favorites-control>
              </td>
              <td class="table-main-title">
                <a href="queries/{{query.id}}">{{query.name}}</a>
                <br>
                <span class="label label-default" ng-if="query.is_draft">Unpublished</span>
                <tags-control item="query"></tags-control>
              </td>
              <td class="p-r-0">
                <img ng-src="{{query.user.profile_image_url}}" class="profile__image_thumb" title="Created by {{query.user.name}}" />
              </td>
              <td>{{query.created_at | dateTime}}</td>
              <td>{{query.runtime | durationHumanize}}</td>
              <td>{{query.retrieved_at | dateTime}}</td>
              <td>{{query.schedule | scheduleHumanize}}</td>
            </tr>
          </tbody>
        </table>
        <paginator paginator="$ctrl.paginator"></paginator>
      </div>
    </div>

    <div class="col-md-3 list-control-r-b">
      <div ng-if="$ctrl.currentPage != 'my'" class="m-b-10">
        <input type="text" class="form-control" placeholder="Search Queries..." autofocus ng-model="$ctrl.term" ng-model-options="{ allowInvalid: true, debounce: 200 }"
               ng-change="$ctrl.update()">
      </div>

      <div class='list-group m-b-10 tags-list tiled'>
        <a href="queries" class="list-group-item" ng-class="{active: $ctrl.currentPage == 'all'}">
          All Queries
        </a>
        <a href="queries/favorite" class="list-group-item" ng-class="{active: $ctrl.currentPage == 'favorites'}">
          <span class="btn-favourite">
            <i class="fa fa-star" aria-hidden="true"></i>
          </span>
          Favorites
        </a>
        <a href="queries/my" class="list-group-item" ng-if="$ctrl.showMyQueries" ng-class="{active: $ctrl.currentPage == 'my'}">
          <img ng-src="{{$ctrl.currentUser.profile_image_url}}" class="profile__image--navbar" width="13" style="margin-right: 0;"
          /> My Queries
        </a>
      </div>
      <div ng-if="$ctrl.currentPage != 'my'">
        <tags-list tags-url="api/queries/tags" on-tags-update="$ctrl.onTagsUpdate"></tags-list>
      </div>
    </div>
  </div>
</div>
